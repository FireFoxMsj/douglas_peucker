require "spec_helper"

describe DouglasPeucker::LineSimplifier, "with two points" do
  let(:line) { [[0, 0], [99, 1]] }

  it "returns both points with a small threshold" do
    DouglasPeucker::LineSimplifier.new(line).threshold(10e-5).points.should == line
  end

  it "returns both points with a big threshold" do
    DouglasPeucker::LineSimplifier.new(line).threshold(99).points.should == line
  end
end

describe DouglasPeucker::LineSimplifier, "with a simple line" do
  let(:line) { [[0, 0], [2, 0], [4, 4]] }

  it "includes all three points if threshold is zero" do
    DouglasPeucker::LineSimplifier.new(line).threshold(10e-5).points.should == line
  end

  it "includes all three points if threshold is too small" do
    DouglasPeucker::LineSimplifier.new(line).threshold(1).points.should == line
    DouglasPeucker::LineSimplifier.new(line).threshold((2**0.5).round(5)).points.should == line
  end

  it "excludes points if threshold is big enough" do
    DouglasPeucker::LineSimplifier.new(line).threshold((2**0.5) + 0.3).points.should == [[0, 0], [4, 4]]
  end
end

describe DouglasPeucker::LineSimplifier, "with a bigger line" do
  let(:line) do
    [
      [0, 0],
      [1, 1],
      [2, 1],
      [3, 2.5],
      [4, 4]
    ]
  end

  it "oversimplifies with a large threshold" do
    DouglasPeucker::LineSimplifier.new(line).threshold(2).points.should == [[0, 0], [4, 4]]
  end
end

# List of points from
# http://www.phpriot.com/articles/reducing-map-path-douglas-peucker-algorithm/4
describe DouglasPeucker::LineSimplifier, "with a massive line" do
  let(:line) do
    [
      [-33.3240789844364,115.638325287067],
      [-33.3240755555556,115.638360555556],
      [-33.3240722222222,115.638396666667],
      [-33.3240783333333,115.638419444444],
      [-33.3246238888889,115.638753333333],
      [-33.3246716666667,115.638813888889],
      [-33.3247216666667,115.638857777778],
      [-33.3247783333333,115.638908333333],
      [-33.3248188888889,115.638933333333],
      [-33.3248483333333,115.638941666667],
      [-33.3248366666667,115.63901],
      [-33.3246905555556,115.639496666667],
      [-33.3244577777778,115.639959444444],
      [-33.3243933333333,115.640034444444],
      [-33.3247722222222,115.64049],
      [-33.3250116666667,115.640761666667],
      [-33.3252088888889,115.640923888889],
      [-33.3254516666667,115.641070555556],
      [-33.3258016666667,115.641201666667],
      [-33.3260861111111,115.641242777778],
      [-33.3262483333333,115.641245555556],
      [-33.3264027777778,115.641217777778],
      [-33.3266022222222,115.64116],
      [-33.3267394444444,115.641115555556],
      [-33.3271016666667,115.640994444444],
      [-33.32748,115.640953888889],
      [-33.3278433333333,115.640965],
      [-33.3278988888889,115.640971666667],
      [-33.3280316666667,115.641007222222],
      [-33.3282477777778,115.641089444444],
      [-33.3284666666667,115.641213888889],
      [-33.3286688888889,115.641335],
      [-33.3292377777778,115.641728333333],
      [-33.3297683333333,115.642054444444],
      [-33.3307816666667,115.642637222222],
      [-33.3316822222222,115.643195],
      [-33.3317516666667,115.643238333333],
      [-33.3336577777778,115.644440555556],
      [-33.3339866666667,115.644631666667],
      [-33.3348883333333,115.645208333333],
      [-33.33618,115.646065555556],
      [-33.3363022222222,115.646147777778],
      [-33.3365594444444,115.646294444444],
      [-33.33716,115.646660555556],
      [-33.3372666666667,115.646722777778],
      [-33.3375916666667,115.646892222222],
      [-33.3383216666667,115.647232777778],
      [-33.3385261111111,115.647322777778],
      [-33.3386222222222,115.647397777778],
      [-33.3389205555556,115.647555555556],
      [-33.3395622222222,115.647913333333],
      [-33.3399055555556,115.648169444444],
      [-33.34017,115.648402777778],
      [-33.3402622222222,115.648500555556],
      [-33.3405927777778,115.648932777778],
      [-33.3407822222222,115.649263333333],
      [-33.3408994444444,115.649528888889],
      [-33.3409622222222,115.64974],
      [-33.3409805555556,115.649866111111],
      [-33.3410077777778,115.650059444444],
      [-33.3410266666667,115.650232777778],
      [-33.3410333333333,115.650487222222],
      [-33.3410283333333,115.650679444444],
      [-33.341005,115.650836666667],
      [-33.3409177777778,115.651433888889],
      [-33.3408427777778,115.651975555556],
      [-33.3407094444444,115.652796666667],
      [-33.340705,115.652825],
      [-33.34062,115.653385555556],
      [-33.3405794444444,115.653650555556],
      [-33.3405572222222,115.653795555556],
      [-33.340415,115.654651111111],
      [-33.3401177777778,115.654593333333],
      [-33.3396,115.654533888889],
      [-33.3392644444444,115.654541666667],
      [-33.3386505555556,115.654514444444],
      [-33.3384444444444,115.654475555556],
      [-33.3383433333333,115.654471111111],
      [-33.337535,115.654371666667],
      [-33.3364127777778,115.654178888889],
      [-33.336375,115.654177222222],
      [-33.3363755555556,115.65417],
      [-33.3363755555556,115.654162222222],
      [-33.3363755555556,115.654153888889],
      [-33.3363744444444,115.654145555556],
      [-33.3363733333333,115.654137777778],
      [-33.3363716666667,115.654129444444],
      [-33.3363694444444,115.654121666667],
      [-33.3363672222222,115.654114444444],
      [-33.3363638888889,115.654106666667],
      [-33.3363605555556,115.654099444444],
      [-33.3363566666667,115.654092777778],
      [-33.3363527777778,115.654086111111],
      [-33.3363483333333,115.65408],
      [-33.3363433333333,115.654073888889],
      [-33.3363383333333,115.654068888889],
      [-33.3363327777778,115.654063888889],
      [-33.3363272222222,115.654058888889],
      [-33.3363211111111,115.654055],
      [-33.336315,115.654051666667],
      [-33.3363083333333,115.654048333333],
      [-33.3363022222222,115.654045555556],
      [-33.3362955555556,115.654043333333],
      [-33.3362883333333,115.654042222222],
      [-33.3362816666667,115.654041111111],
      [-33.336275,115.654040555556],
      [-33.3362677777778,115.654040555556],
      [-33.3362611111111,115.654041111111],
      [-33.3362544444444,115.654042222222],
      [-33.3362477777778,115.654044444444],
      [-33.3362411111111,115.654046666667],
      [-33.3362344444444,115.654049444444],
      [-33.3362283333333,115.654052777778],
      [-33.3362222222222,115.654056111111],
      [-33.3362161111111,115.654060555556],
      [-33.3362105555556,115.654065],
      [-33.336205,115.654070555556],
      [-33.3362,115.654076111111],
      [-33.3361955555556,115.654081666667],
      [-33.3361911111111,115.654088333333],
      [-33.3361872222222,115.654095],
      [-33.3361833333333,115.654101666667],
      [-33.33618,115.654108888889],
      [-33.3361772222222,115.654116666667],
      [-33.336175,115.654124444444],
      [-33.3361727777778,115.654132222222],
      [-33.3361711111111,115.65414],
      [-33.3361705555556,115.654148333333],
      [-33.3361694444444,115.654156666667],
      [-33.3361694444444,115.654164444444],
      [-33.33617,115.654172777778],
      [-33.3361705555556,115.654181111111],
      [-33.3361716666667,115.654188888889],
      [-33.3361733333333,115.654197222222],
      [-33.3361755555556,115.654205],
      [-33.3361783333333,115.654212222222],
      [-33.3361811111111,115.65422],
      [-33.3361844444444,115.654227222222],
      [-33.3361883333333,115.654233888889],
      [-33.3361922222222,115.654240555556],
      [-33.3361966666667,115.654246666667],
      [-33.3362016666667,115.654252222222],
      [-33.3362066666667,115.654257777778],
      [-33.3362122222222,115.654262777778],
      [-33.3362177777778,115.654267222222],
      [-33.3362238888889,115.654271666667],
      [-33.33623,115.654275],
      [-33.3362366666667,115.654278333333],
      [-33.3362433333333,115.654281111111],
      [-33.33625,115.654282777778],
      [-33.3362566666667,115.654284444444],
      [-33.3362633333333,115.654285555556],
      [-33.3362705555556,115.654286111111],
      [-33.3362594444444,115.657527222222],
      [-33.3362694444444,115.658115],
      [-33.3362772222222,115.661860555556],
      [-33.3362666666667,115.663044444444],
      [-33.3362588888889,115.663943888889],
      [-33.3362666666667,115.664742777778],
      [-33.3362638888889,115.664801111111],
      [-33.3362094444444,115.664952777778],
      [-33.3361661111111,115.665025],
      [-33.3361244444444,115.665072777778],
      [-33.3360622222222,115.66512],
      [-33.3359894444444,115.665158333333],
      [-33.3358877777778,115.665172777778],
      [-33.3357855555556,115.665168333333],
      [-33.335585,115.665027777778],
      [-33.3350388888889,115.664572777778],
      [-33.3345688888889,115.664177222222],
      [-33.333825,115.663587777778],
      [-33.3328094444444,115.662822222222],
      [-33.3325316666667,115.662621111111],
      [-33.3323305555556,115.662475],
      [-33.3322338888889,115.662401111111],
      [-33.3321866666667,115.662373333333],
      [-33.3321555555556,115.662366111111],
      [-33.3321172222222,115.662363333333],
      [-33.3320261111111,115.662363333333],
      [-33.3318933333333,115.662373888889],
      [-33.3319111111111,115.66242],
      [-33.3319816666667,115.662791666667],
      [-33.3320411111111,115.663145],
      [-33.3320822222222,115.663462222222],
      [-33.3321,115.663766666667],
      [-33.332095,115.664183333333],
      [-33.3320761111111,115.664577777778],
      [-33.3320144444444,115.664891666667],
      [-33.3319433333333,115.665122222222],
      [-33.3322855555556,115.665379444444],
      [-33.3331094444444,115.666027222222],
      [-33.3335483333333,115.666373888889],
      [-33.3336416666667,115.666491666667],
      [-33.3338494444444,115.666663333333],
      [-33.334155,115.666840555556],
      [-33.3348594444444,115.667103888889],
      [-33.3350183333333,115.667190555556],
      [-33.335155,115.667307222222],
      [-33.3352505555556,115.667408333333],
      [-33.3353327777778,115.667505],
      [-33.335585,115.667743333333],
      [-33.3358294444444,115.668190555556],
      [-33.3359744444444,115.66853],
      [-33.3360222222222,115.668892777778],
      [-33.3360344444444,115.669116666667],
      [-33.3360388888889,115.669197222222],
      [-33.33605,115.670768888889],
      [-33.3360455555556,115.672128888889],
      [-33.3360255555556,115.674903888889],
      [-33.3360227777778,115.676181111111],
      [-33.3360094444444,115.677107777778],
      [-33.3359277777778,115.678325],
      [-33.3357772222222,115.679310555556],
      [-33.3354888888889,115.680615],
      [-33.3353194444444,115.681237222222],
      [-33.3349355555556,115.682392222222],
      [-33.3346111111111,115.683531666667],
      [-33.3343683333333,115.684342222222],
      [-33.3340466666667,115.685418888889],
      [-33.3336411111111,115.686831111111],
      [-33.3335783333333,115.687009444444],
      [-33.3335166666667,115.687186111111],
      [-33.3333222222222,115.687761111111],
      [-33.3330883333333,115.688365555556],
      [-33.3327988888889,115.689008333333],
      [-33.3325322222222,115.689537222222],
      [-33.3322255555556,115.690066111111],
      [-33.3319261111111,115.690547222222],
      [-33.3315672222222,115.69107],
      [-33.3314077777778,115.691283888889],
      [-33.3310461111111,115.691757222222],
      [-33.3298994444444,115.693195],
      [-33.3291927777778,115.694116111111],
      [-33.3287655555556,115.694647222222],
      [-33.3280827777778,115.695564444444],
      [-33.3276688888889,115.696246111111],
      [-33.3276005555556,115.696347777778],
      [-33.3274927777778,115.696505],
      [-33.3274327777778,115.696578333333],
      [-33.3273633333333,115.696640555556],
      [-33.3273061111111,115.696677777778],
      [-33.3272094444444,115.696726111111],
      [-33.3271427777778,115.696745555556],
      [-33.3270638888889,115.696761111111],
      [-33.3268266666667,115.696790555556],
      [-33.3266177777778,115.6968],
      [-33.3265144444444,115.696808888889],
      [-33.3263777777778,115.696821666667],
      [-33.3262744444444,115.696834444444],
      [-33.3261411111111,115.696861666667],
      [-33.3258988888889,115.696919444444],
      [-33.3257561111111,115.696950555556],
      [-33.3255227777778,115.69699],
      [-33.325365,115.697006666667],
      [-33.3251983333333,115.69702],
      [-33.3250888888889,115.697021666667],
      [-33.3249761111111,115.69702],
      [-33.3247816666667,115.697001111111],
      [-33.3245933333333,115.696989444444],
      [-33.3244227777778,115.696955555556],
      [-33.324355,115.696985],
      [-33.3240672222222,115.696919444444],
      [-33.3230883333333,115.696683333333],
      [-33.32234,115.696469444444],
      [-33.3217983333333,115.696355],
      [-33.321045,115.696186111111],
      [-33.3208144444444,115.696146111111],
      [-33.3191055555556,115.695857777778],
      [-33.3173294444444,115.695498333333],
      [-33.3168344444444,115.695422777778],
      [-33.3160822222222,115.695284444444],
      [-33.3158644444444,115.695241666667],
      [-33.3152672222222,115.695123888889],
      [-33.3152677777778,115.695121111111],
      [-33.3152688888889,115.695108888889],
      [-33.31527,115.695096666667],
      [-33.3152705555556,115.695085],
      [-33.3152705555556,115.695072777778],
      [-33.3152705555556,115.695060555556],
      [-33.3152694444444,115.695048333333],
      [-33.3152683333333,115.695036666667],
      [-33.3152666666667,115.695024444444],
      [-33.3152644444444,115.695012777778],
      [-33.3152616666667,115.695001111111],
      [-33.3152588888889,115.694989444444],
      [-33.315255,115.694978333333],
      [-33.3152511111111,115.694967222222],
      [-33.3152466666667,115.694956111111],
      [-33.3152422222222,115.694945555556],
      [-33.3152366666667,115.694935],
      [-33.3152311111111,115.694925],
      [-33.3152255555556,115.694915],
      [-33.3152188888889,115.694905555556],
      [-33.3152122222222,115.694896111111],
      [-33.3152055555556,115.694887777778],
      [-33.3151983333333,115.694879444444],
      [-33.3151905555556,115.694871111111],
      [-33.3151827777778,115.694863888889],
      [-33.3151744444444,115.694856666667],
      [-33.3151661111111,115.69485],
      [-33.3151572222222,115.694843888889],
      [-33.3151483333333,115.694837777778],
      [-33.3151388888889,115.694832777778],
      [-33.3151294444444,115.694827777778],
      [-33.31512,115.694823888889],
      [-33.3151105555556,115.69482],
      [-33.3151005555556,115.694816666667],
      [-33.3150905555556,115.694813888889],
      [-33.3150805555556,115.694811666667],
      [-33.3150705555556,115.69481],
      [-33.3150638888889,115.694809444444],
      [-33.3150605555556,115.694809444444],
      [-33.3150505555556,115.694808888889],
      [-33.3150405555556,115.694808888889],
      [-33.31503,115.694809444444],
      [-33.31502,115.694810555556],
      [-33.31501,115.694812222222],
      [-33.315,115.694814444444],
      [-33.31499,115.694817222222],
      [-33.3149805555556,115.694820555556],
      [-33.3149705555556,115.694823888889],
      [-33.3149611111111,115.694828333333],
      [-33.3149516666667,115.694833333333],
      [-33.3149427777778,115.694838333333],
      [-33.3149338888889,115.694844444444],
      [-33.314925,115.694850555556],
      [-33.3149166666667,115.694857222222],
      [-33.3149083333333,115.694864444444],
      [-33.3149005555556,115.694872222222],
      [-33.3148927777778,115.69488],
      [-33.3148855555556,115.694888333333],
      [-33.3148788888889,115.694897222222],
      [-33.3148722222222,115.694906666667],
      [-33.3148661111111,115.694916111111],
      [-33.31486,115.694926111111],
      [-33.3148544444444,115.694936111111],
      [-33.3148494444444,115.694946666667],
      [-33.3148444444444,115.694957222222],
      [-33.31484,115.694968333333],
      [-33.3148361111111,115.694979444444],
      [-33.3148327777778,115.694991111111],
      [-33.31483,115.695002222222],
      [-33.3148272222222,115.695013888889],
      [-33.314825,115.695026111111],
      [-33.3148233333333,115.695037777778],
      [-33.3148222222222,115.69505],
      [-33.3148216666667,115.695062222222],
      [-33.3148211111111,115.695073888889],
      [-33.3147438888889,115.695072222222],
      [-33.3145216666667,115.695077222222],
      [-33.3142655555556,115.695102222222],
      [-33.3138061111111,115.695135555556],
      [-33.31346,115.695201666667],
      [-33.3130127777778,115.695333888889],
      [-33.3125211111111,115.695484444444],
      [-33.3123194444444,115.695587222222],
      [-33.3120872222222,115.695690555556],
      [-33.3118622222222,115.695798333333],
      [-33.31175,115.695856666667],
      [-33.3115977777778,115.69595],
      [-33.3114672222222,115.696025555556],
      [-33.3113183333333,115.696106111111],
      [-33.3111855555556,115.696187777778],
      [-33.31112,115.696235555556],
      [-33.3109944444444,115.696335],
      [-33.3108894444444,115.696411666667],
      [-33.3107816666667,115.696497222222],
      [-33.3106561111111,115.696602777778],
      [-33.3098788888889,115.697270555556],
      [-33.3097755555556,115.697339444444],
      [-33.3097555555556,115.697353333333],
      [-33.3097444444444,115.697361111111],
      [-33.3093833333333,115.697713333333],
      [-33.3090761111111,115.697967777778],
      [-33.3087366666667,115.698245555556],
      [-33.3085644444444,115.698388888889],
      [-33.3083677777778,115.698551666667],
      [-33.30808,115.698808888889],
      [-33.3076816666667,115.699201111111],
      [-33.3071077777778,115.699707777778],
      [-33.30673,115.700068333333],
      [-33.3063894444444,115.700397777778],
      [-33.30606,115.700706666667],
      [-33.3057366666667,115.700995],
      [-33.3054838888889,115.701237777778],
      [-33.3055772222222,115.701379444444],
      [-33.30561,115.701519444444],
      [-33.3056127777778,115.701662777778],
      [-33.3056261111111,115.702640555556],
      [-33.3056266666667,115.702681111111],
      [-33.3056583333333,115.702921111111],
      [-33.3057144444444,115.703187222222],
      [-33.3057894444444,115.703453888889],
      [-33.3059144444444,115.703747222222],
      [-33.30613,115.704095],
      [-33.3063644444444,115.704267222222],
      [-33.3068955555556,115.704573888889],
      [-33.3077883333333,115.704722777778],
      [-33.30797,115.704753333333],
      [-33.3082938888889,115.704819444444]
    ]
  end

  it "simplifies the line correctly" do
    DouglasPeucker::LineSimplifier.new(line).threshold(0.00005).points.length.should == 70
  end
end
